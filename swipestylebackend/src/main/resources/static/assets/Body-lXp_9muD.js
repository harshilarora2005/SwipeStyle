import{r as o,U as P,j as t,L as R}from"./index-Bm40GKLM.js";import{g as y,u as M,a as U,b as W,c as z,S as F}from"./useSwipeInteractions-90JvqybX.js";import{u as O}from"./useAuth-By2pufHH.js";import"./UserClothingService-DE_HXjOH.js";function T(s){let a=s.length,i;for(;a!==0;)i=Math.floor(Math.random()*a),a--,[s[a],s[i]]=[s[i],s[a]];return s}const V=s=>{const[a,i]=o.useState([]),[p,d]=o.useState(!0),[m,u]=o.useState(!1),[l,I]=o.useState(!1);return o.useEffect(()=>{let n;const e=async()=>{try{const c=await y(s);if(c.status===202)console.log("Scraping in progress..."),u(!0),d(!0),I(!0);else if(c.status===200){console.log("Data received successfully");const r=T(c.data);i(r||[]),d(!1),u(!1),clearInterval(n)}else console.log("Unexpected status:",c.status),d(!1),u(!1)}catch(c){console.error("Failed to fetch clothing data:",c),d(!1),u(!1),clearInterval(n)}};return e(),n=setInterval(e,2e4),()=>clearInterval(n)},[s]),o.useEffect(()=>{const n=setInterval(async()=>{if(!m)try{const e=await y(s);if(e.status===200&&e.data){const r=e.data.filter(h=>!a.some(f=>f.productId===h.productId));r.length>0&&(console.log("New clothing items added:",r.length),i(h=>[...h,...r]))}}catch(e){console.error("Error checking for new clothing:",e)}},3e5);return()=>clearInterval(n)},[m,a,s]),{clothingData:a,loading:p,scrapingInProgress:m,initialScrape:l,setClothingData:i}},S=o.memo(()=>t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:t.jsxs("div",{className:"text-center space-y-3 max-w-sm",children:[t.jsx("div",{className:"w-16 h-16 mx-auto bg-gray-200 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Nothing found"}),t.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:"We couldn't find any items right now. Check back in a moment."})]})}));S.displayName="NoItemsState";const Y=()=>{const{userGender:s,userEmail:a}=o.useContext(P),{authLoading:i}=O(),{interactWithClothing:p}=M(a),{clothingData:d,loading:m,scrapingInProgress:u}=V(s),{visibleCards:l,setVisibleCards:I,currentCardIndex:n,getCurrentCard:e,moveToNextCard:c}=U(d),{setDragPosition:r,handleLike:h,handleSkip:f,handleLikeByDrag:j,handleSkipByDrag:C,isSkipActive:k,isLikeActive:v}=W(p,c),{scrollRef:w,cardRefs:N,detailsY:L,detailsOpacity:b,detailsScale:D,animateCardSwipe:x}=z(),B=o.useCallback(async()=>{const g=e();g&&n<l.length&&(await f(g),x(g.productId,-200),r(-100))},[e,n,l.length,f,x,r]),E=o.useCallback(async()=>{const g=e();g&&n<l.length&&(await h(g),x(g.productId,200),r(100))},[e,n,l.length,h,x,r]);if(i)return t.jsx("div",{className:"min-h-screen flex justify-center items-center bg-gradient-to-br from-pink-50 to-purple-50",children:t.jsx("p",{className:"text-gray-600 text-lg",children:"Loading account info..."})});if(m||u||l.length===0)return t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[t.jsx(R,{}),u&&t.jsx("p",{className:"mt-4 text-gray-600",children:"Scraping in progress... Please wait."})]});if(d.length===0)return t.jsx(S,{});const A=e();return t.jsx(F,{scrollRef:w,visibleCards:l,setVisibleCards:I,currentCardIndex:n,currentItem:A,cardRefs:N,isSkipActive:k,isLikeActive:v,handleSkipButton:B,handleLikeButton:E,handleSkipByDrag:C,handleLikeByDrag:j,setDragPosition:r,detailsY:L,detailsOpacity:b,detailsScale:D})},K=o.memo(Y);export{K as default};
