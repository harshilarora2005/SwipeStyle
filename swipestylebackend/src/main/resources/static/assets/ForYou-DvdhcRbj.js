import{r,U as le,j as e,L as W,E as N}from"./index-Bm40GKLM.js";import{u as de}from"./useAuth-By2pufHH.js";import{u as Y}from"./useGetProducts-DyKsmem5.js";import{u as ue,a as me,b as fe,c as ge,d as xe,S as he}from"./useSwipeInteractions-90JvqybX.js";import"./UserClothingService-DE_HXjOH.js";const we=()=>{const{isLoggedIn:K,userEmail:g}=r.useContext(le),{authLoading:O}=de(),{products:S,loading:z,error:C}=Y(g,"LIKED"),{products:x,loading:b,error:I}=Y(g,"DISLIKED"),[h,p]=r.useState([]),[R,w]=r.useState(!0),[G,E]=r.useState(!1),[D,M]=r.useState(null),[v,d]=r.useState(new Set),u=r.useRef(!1),j=r.useRef(!1),y=r.useRef(!1),{interactWithClothing:V}=ue(g),{visibleCards:o,setVisibleCards:q,currentCardIndex:i,getCurrentCard:m,moveToNextCard:H}=me(h),{setDragPosition:f,handleLike:A,handleSkip:B,handleLikeByDrag:J,handleSkipByDrag:Q,isSkipActive:U,isLikeActive:X}=fe(V,H),{scrollRef:Z,cardRefs:_,detailsY:$,detailsOpacity:T,detailsScale:ee,animateCardSwipe:k}=ge(),s=r.useMemo(()=>S,[S]),L=r.useMemo(()=>!x||x.length===0?new Set:new Set(x.map(t=>t.productId)),[x]),P=r.useCallback(t=>L.size===0?t:t.filter(n=>!L.has(n.productId)),[L]),c=r.useCallback(async(t,n=!1)=>{if(!(!t||t.length===0))try{const a=await xe(t,Array.from(v));if(a.data&&a.data.length>0){const F=P(a.data);p(n?l=>{const oe=F.filter(ie=>!l.some(ce=>ce.productId===ie.productId));return[...l,...oe]}:F);const ae=a.data.map(l=>l.productId);d(l=>new Set([...l,...ae])),M(null),y.current=!1}else n||p([]),console.log("No more recommendations available")}catch(a){console.error("Error fetching recommendations:",a),M(a),y.current=!0}},[v,P]);r.useEffect(()=>{d(new Set),u.current=!1,j.current=!1,y.current=!1},[g]),r.useEffect(()=>{if(!s||s.length===0){w(!1),u.current=!0;return}b||u.current||(w(!0),u.current=!0,c(s,!1).finally(()=>{w(!1)}))},[s,c,b]),r.useEffect(()=>{const t=h.length>0&&o.length<=2;!j.current&&!y.current&&(s==null?void 0:s.length)>0,t&&(j.current=!0,E(!0),console.log("Loading more recommendations. Previously recommended:",v.size),c(s,!0).finally(()=>{E(!1),j.current=!1}))},[i,h.length,s,c]);const te=r.useCallback(async()=>{const t=m();t&&i<o.length&&(await B(t),k(t.productId,-200),f(-100),d(n=>new Set([...n,t.productId])))},[m,i,o.length,B,k,f]),re=r.useCallback(async()=>{const t=m();t&&i<o.length&&(await A(t),k(t.productId,200),f(100),d(n=>new Set([...n,t.productId])))},[m,i,o.length,A,k,f]),se=r.useCallback(()=>{d(new Set),p([]),u.current=!1,(s==null?void 0:s.length)>0&&c(s,!1)},[s,c]);if(O)return e.jsx("div",{className:"min-h-screen flex justify-center items-center bg-gradient-to-br from-pink-50 to-purple-50",children:e.jsx("p",{className:"text-gray-600 text-lg",children:"Loading account info..."})});if(!K)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-600",children:"Please Login First..."})});if(z||b)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50",children:[e.jsx(W,{}),e.jsx("p",{className:"mt-4 text-gray-600 text-lg",children:"Fetching your liked products... ðŸ’•"})]});if(C)return e.jsx(N,{error:C});if(I)return e.jsx(N,{error:I});if(R)return e.jsxs("div",{className:"min-h-screen flex flex-col justify-center items-center bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50",children:[e.jsx(W,{}),e.jsx("p",{className:"mt-4 text-gray-600 text-lg",children:"Loading recommendations just for you..."})]});if(D)return e.jsx(N,{error:D});if(!s||s.length===0)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:e.jsxs("div",{className:"text-center space-y-3 max-w-sm",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Nothing found"}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:"We couldn't find any items right now. Check back in a moment."})]})});if(h.length===0&&!R)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:e.jsxs("div",{className:"text-center space-y-4 max-w-sm",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"All caught up!"}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:"You've seen all available recommendations. Check back later for more!"}),e.jsx("button",{onClick:se,className:"mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Refresh Recommendations"})]})});const ne=m();return e.jsxs(e.Fragment,{children:[e.jsx(he,{scrollRef:Z,visibleCards:o,setVisibleCards:q,currentCardIndex:i,currentItem:ne,cardRefs:_,isSkipActive:U,isLikeActive:X,handleSkipButton:te,handleLikeButton:re,handleSkipByDrag:Q,handleLikeByDrag:J,setDragPosition:f,detailsY:$,detailsOpacity:T,detailsScale:ee}),G&&e.jsx("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-white px-4 py-2 rounded-full shadow text-gray-500 text-sm",children:"Loading more recommendations..."})]})};export{we as default};
